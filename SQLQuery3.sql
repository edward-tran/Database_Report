--TAO DATABASE
-----------------------------
CREATE DATABASE BOOK_STORE
USE BOOK_STORE
GO 
-----------------------------

--TAO TABLE
----------------------------------------
CREATE TABLE CUSTOMER(
	CUSTOMER_ID nvarchar(20) primary key
	,CUSTOMER_NAME nvarchar(50) not null
	,CUSTOMER_ADDRESS nvarchar(100)
	,PHONE_NUMBER varchar(30)
)
GO 

CREATE TABLE EMPLOYEE(
	EMPLOYEE_ID nvarchar(20) primary key
	,EMPLOYEE_NAME nvarchar(50) not null
	,EMPLOYEE_ADDRESS nvarchar(100)
	,PHONE_NUMBER varchar(30)
)
GO 

CREATE TABLE CATEGORY(
	CATEGORY_ID nvarchar(20) primary key
	,CATEGORY_NAME nvarchar(50) not null
)
GO

CREATE TABLE AUTHOR(
	AUTHOR_ID nvarchar(20) primary key
	,AUTHOR_NAME nvarchar(50) not null
)
GO

CREATE TABLE PUBLISHER(
	PUBLISHER_ID nvarchar(20) primary key
	,PUBLISHER_NAME nvarchar(20) not null
)
GO

CREATE TABLE BOOK(
	BOOK_ID nvarchar(20) primary key
	,BOOK_NAME nvarchar(50) not null
	,PRICE decimal
	,CATEGORY_ID nvarchar(20)
	,PUBLISHER_ID nvarchar(20)
)
GO 

CREATE TABLE BOOK_AUTHOR(
	BOOK_ID nvarchar(20) 
	,AUTHOR_ID nvarchar(20) 
	,primary key (BOOK_ID, AUTHOR_ID)
)
GO

CREATE TABLE INVOICES(
	INVOICES_ID nvarchar(20) primary key
	,DAY_ADDED date
	,SUM_OF_MONEY decimal
	,CUSTOMER_ID nvarchar(20)
	,EMPLOYEE_ID nvarchar(20)
)
GO

CREATE TABLE INVOICES_BOOK(
	INVOICES_ID nvarchar(20) 
	,BOOK_ID nvarchar(20)
	,NUMBER_OF_BOOK int not null
	,primary key (INVOICES_ID, BOOK_ID) 
)
GO
---------------------------------------

--THIET LAP FOREIGN KEY DE TAO RELATIONSHIP
-----------------------------------------------------------------------------------------
ALTER TABLE BOOK ADD foreign key (CATEGORY_ID) REFERENCES CATEGORY(CATEGORY_ID)
ALTER TABLE BOOK ADD foreign key (PUBLISHER_ID) REFERENCES PUBLISHER(PUBLISHER_ID)
ALTER TABLE INVOICES ADD foreign key (CUSTOMER_ID) REFERENCES CUSTOMER(CUSTOMER_ID)
ALTER TABLE INVOICES ADD foreign key (EMPLOYEE_ID) REFERENCES EMPLOYEE(EMPLOYEE_ID)
ALTER TABLE BOOK_AUTHOR ADD foreign key (BOOK_ID) REFERENCES BOOK(BOOK_ID)
ALTER TABLE BOOK_AUTHOR ADD foreign key (AUTHOR_ID) REFERENCES AUTHOR(AUTHOR_ID)
ALTER TABLE INVOICES_BOOK ADD foreign key (INVOICES_ID) REFERENCES INVOICES(INVOICES_ID)
ALTER TABLE INVOICES_BOOK ADD foreign key (BOOK_ID) REFERENCES BOOK(BOOK_ID)
-----------------------------------------------------------------------------------------

--NHAP DU LIEU
--------------------------------------------------------------------------------------------------------------------------------------------
--Bang CUSTOMER
INSERT INTO CUSTOMER(CUSTOMER_ID, CUSTOMER_NAME, CUSTOMER_ADDRESS, PHONE_NUMBER) VALUES ('C001','Tran Van An','Ho Chi Minh',0123456789)
INSERT INTO CUSTOMER(CUSTOMER_ID, CUSTOMER_NAME, CUSTOMER_ADDRESS, PHONE_NUMBER) VALUES ('C002','Nguyen Thi Bong','Binh Duong',0123498765)
INSERT INTO CUSTOMER(CUSTOMER_ID, CUSTOMER_NAME, CUSTOMER_ADDRESS, PHONE_NUMBER) VALUES ('C003','Le Van Cuong','Binh Phuoc',0987654321)
INSERT INTO CUSTOMER(CUSTOMER_ID, CUSTOMER_NAME, CUSTOMER_ADDRESS, PHONE_NUMBER) VALUES ('C004','Huynh Minh Dung','Dong Nai',0987651234)
INSERT INTO CUSTOMER(CUSTOMER_ID, CUSTOMER_NAME, CUSTOMER_ADDRESS, PHONE_NUMBER) VALUES ('C005','Hoang Ngoc Duc','Long An',0123456987)

--Bang EMPLOYEE
INSERT INTO EMPLOYEE(EMPLOYEE_ID, EMPLOYEE_NAME, EMPLOYEE_ADDRESS, PHONE_NUMBER) VALUES ('E001','Tran Mai Anh','Ho Chi Minh',0121234568)
INSERT INTO EMPLOYEE(EMPLOYEE_ID, EMPLOYEE_NAME, EMPLOYEE_ADDRESS, PHONE_NUMBER) VALUES ('E002','Le Bao Binh','Ho Chi Minh',0923546752)
INSERT INTO EMPLOYEE(EMPLOYEE_ID, EMPLOYEE_NAME, EMPLOYEE_ADDRESS, PHONE_NUMBER) VALUES ('E003','Nguyen Van Chien','Ho Chi Minh',0132658796)
INSERT INTO EMPLOYEE(EMPLOYEE_ID, EMPLOYEE_NAME, EMPLOYEE_ADDRESS, PHONE_NUMBER) VALUES ('E004','Mai Thanh Danh','Ho Chi Minh',0976325373)
INSERT INTO EMPLOYEE(EMPLOYEE_ID, EMPLOYEE_NAME, EMPLOYEE_ADDRESS, PHONE_NUMBER) VALUES ('E005','Phan Hoang Huy','Ho Chi Minh',0921287340)

--Bang CATEGORY
INSERT INTO CATEGORY(CATEGORY_ID, CATEGORY_NAME) VALUES ('CA01','Am Thuc')
INSERT INTO CATEGORY(CATEGORY_ID, CATEGORY_NAME) VALUES ('CA02','Lam dep')
INSERT INTO CATEGORY(CATEGORY_ID, CATEGORY_NAME) VALUES ('CA03','Nghe Thuat')
INSERT INTO CATEGORY(CATEGORY_ID, CATEGORY_NAME) VALUES ('CA04','Van Hoc')
INSERT INTO CATEGORY(CATEGORY_ID, CATEGORY_NAME) VALUES ('CA05','Thoi Trang')

--Bang AUTHOR
INSERT INTO AUTHOR(AUTHOR_ID, AUTHOR_NAME) VALUES ('AU01','Gordon Ramsay')
INSERT INTO AUTHOR(AUTHOR_ID, AUTHOR_NAME) VALUES ('AU02','Okyanmama')
INSERT INTO AUTHOR(AUTHOR_ID, AUTHOR_NAME) VALUES ('AU03','Niki Brantmark')
INSERT INTO AUTHOR(AUTHOR_ID, AUTHOR_NAME) VALUES ('AU04','Ernest Hermingway')
INSERT INTO AUTHOR(AUTHOR_ID, AUTHOR_NAME) VALUES ('AU05','Rebecca Arnold')
INSERT INTO AUTHOR(AUTHOR_ID, AUTHOR_NAME) VALUES ('AU06','Charlotte Cho')
INSERT INTO AUTHOR(AUTHOR_ID, AUTHOR_NAME) VALUES ('AU07','Sasaki Fumio')

--Bang PUBLISHER
INSERT INTO PUBLISHER(PUBLISHER_ID, PUBLISHER_NAME) VALUES ('PU01','Nha Nam')
INSERT INTO PUBLISHER(PUBLISHER_ID, PUBLISHER_NAME) VALUES ('PU02','Thai Ha')
INSERT INTO PUBLISHER(PUBLISHER_ID, PUBLISHER_NAME) VALUES ('PU03','Phuong Nam')
INSERT INTO PUBLISHER(PUBLISHER_ID, PUBLISHER_NAME) VALUES ('PU04','Dong A')
INSERT INTO PUBLISHER(PUBLISHER_ID, PUBLISHER_NAME) VALUES ('PU05','First News')

--Bang BOOK
INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B001','Gordon Ramsay"s Ultimate Home Cooking',700000,'CA01','PU01')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B002','Cooking for Friends',500000,'CA01','PU01')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B003','Vu dieu cua lan da',65400,'CA02','PU02')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B004','Lagom: Not Too Little, Not Too Much',350000,'CA03','PU03')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B005','For Whom the Bell Tolls',200000,'CA04','PU04')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B006','The Old Man and the Sea',125000,'CA04','PU04')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B007','Fashion, desire and anxiety',305000,'CA05','PU05')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B008','Avedon Advertising',195000,'CA05','PU05')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B009','Bi Quyet Duong Da Kieu Han Quoc',90000,'CA02','PU04')

INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B010','Loi song toi gian cua nguoi Nhat',95000,'CA03','PU02')

--Bang INVOICES
INSERT INTO INVOICES(INVOICES_ID, DAY_ADDED, SUM_OF_MONEY, CUSTOMER_ID, EMPLOYEE_ID) 
VALUES ('I001','2020-4-30',1000000,'C001','E002')
INSERT INTO INVOICES(INVOICES_ID, DAY_ADDED, SUM_OF_MONEY, CUSTOMER_ID, EMPLOYEE_ID) 
VALUES ('I002','2020-5-1',1700000,'C002','E004')
INSERT INTO INVOICES(INVOICES_ID, DAY_ADDED, SUM_OF_MONEY, CUSTOMER_ID, EMPLOYEE_ID) 
VALUES ('I003','2020-5-1',900000,'C004','E001')
INSERT INTO INVOICES(INVOICES_ID, DAY_ADDED, SUM_OF_MONEY, CUSTOMER_ID, EMPLOYEE_ID) 
VALUES ('I004','2020-5-2',325000,'C003','E005')
INSERT INTO INVOICES(INVOICES_ID, DAY_ADDED, SUM_OF_MONEY, CUSTOMER_ID, EMPLOYEE_ID) 
VALUES ('I005','2020-5-3',500000,'C005','E003')

--Bang BOOK_AUTHOR
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B001','AU01')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B002','AU01')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B003','AU02')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B004','AU03')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B005','AU04')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B006','AU04')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B007','AU05')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B008','AU05')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B009','AU06')
INSERT INTO BOOK_AUTHOR(BOOK_ID, AUTHOR_ID) VALUES ('B010','AU07')

--Bang INVOICES_BOOK
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I001','B002',2)
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I002','B001',1)
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I002','B002',2)
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I003','B001',1)
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I003','B005',1)
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I004','B005',1)
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I004','B006',1)
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I005','B007',1)
INSERT INTO INVOICES_BOOK(INVOICES_ID, BOOK_ID, NUMBER_OF_BOOK) VALUES ('I005','B008',1)

---------------------------------------------------------------------------------------------------------------------------

--TRUY VAN
USE BOOK_STORE
GO
--1
SELECT *FROM CUSTOMER

--2
SELECT EMPLOYEE_ID,EMPLOYEE_NAME FROM EMPLOYEE

--3
SELECT AUTHOR_NAME FROM AUTHOR WHERE AUTHOR_NAME LIKE '%E%'

--4
SELECT BOOK_NAME, CATEGORY_NAME 
FROM CATEGORY, BOOK
WHERE CATEGORY.CATEGORY_ID=BOOK.CATEGORY_ID AND CATEGORY.CATEGORY_NAME='Van Hoc'

--5
SELECT BOOK_ID, BOOK_NAME, PRICE FROM BOOK WHERE PRICE > 150000

--6
SELECT COUNT(INVOICES_ID) AS SO_LUONG FROM INVOICES WHERE DAY_ADDED BETWEEN '2020-04-30' AND '2020-05-01' 

--7
SELECT AUTHOR_NAME, BOOK_NAME 
FROM BOOK, AUTHOR, BOOK_AUTHOR
WHERE BOOK.BOOK_ID=BOOK_AUTHOR.BOOK_ID AND AUTHOR.AUTHOR_ID=BOOK_AUTHOR.AUTHOR_ID AND AUTHOR.AUTHOR_NAME='Gordon Ramsay'

--8
SELECT EMPLOYEE.EMPLOYEE_ID, COUNT(INVOICES.INVOICES_ID) AS SO_LUONG
FROM EMPLOYEE, INVOICES
WHERE EMPLOYEE.EMPLOYEE_ID=INVOICES.EMPLOYEE_ID
GROUP BY EMPLOYEE.EMPLOYEE_ID

--9

SELECT PUBLISHER_NAME,COUNT(BOOK.PUBLISHER_ID) AS SO_LUONG
FROM BOOK, PUBLISHER
WHERE BOOK.PUBLISHER_ID=PUBLISHER.PUBLISHER_ID
GROUP BY PUBLISHER.PUBLISHER_NAME
HAVING COUNT(BOOK.PUBLISHER_ID) <3

--10
SELECT *
FROM BOOK B1
WHERE B1.PRICE>(
	SELECT AVG(B2.PRICE)
	FROM BOOK B2
	WHERE B1.PUBLISHER_ID=B2.PUBLISHER_ID
)

------------------------------------------------------------------------------------------
UPDATE CUSTOMER SET CUSTOMER_ADDRESS='Ho Chi Minh' WHERE CUSTOMER_ID='C002'
INSERT INTO BOOK(BOOK_ID, BOOK_NAME, PRICE, CATEGORY_ID, PUBLISHER_ID) 
VALUES ('B011','Loi song toi gian cua nguoi Viet Nam',95000,'CA03','PU02')
DELETE FROM BOOK WHERE BOOK_ID='B011'

